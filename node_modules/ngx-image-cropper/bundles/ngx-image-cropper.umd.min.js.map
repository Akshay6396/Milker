{"version":3,"sources":["ng://ngx-image-cropper/src/image.utils.ts","ng://ngx-image-cropper/src/image-cropper.component.ts","ng://ngx-image-cropper/src/image-cropper.module.ts"],"names":["ImageUtils","getOrientation","imageBase64","view","DataView","this","base64ToArrayBuffer","getUint16","length","byteLength","offset","marker","getUint32","little","tags","i","replace","binaryString","atob","len","bytes","Uint8Array","charCodeAt","buffer","resetOrientation","srcBase64","srcOrientation","callback","img","Image","onload","width","height","canvas","document","createElement","ctx","getContext","transformCanvas","drawImage","toDataURL","src","orientation","transform","ImageCropperComponent","elementRef","sanitizer","cd","zone","x1","y1","x2","y2","EventEmitter","initCropper","Object","defineProperty","prototype","file","loadImageFile","event","target","files","loadBase64Image","ngOnChanges","changes","_this","setTimeout","setMaxSize","checkCropperPosition","doAutoCrop","markForCheck","resetCropperPosition","imageVisible","originalImage","safeImgDataUrl","moveStart","active","type","position","clientX","clientY","maxSize","originalSize","cropper","fileReader","FileReader","imageType","isValidImageType","checkExifRotationAndLoadImage","result","e","loadImageFailed","emit","readAsDataURL","exifRotation","rotatedBase64","bypassSecurityTrustResourceUrl","imageLoadedInView","imageLoaded","onResize","resizeCropperPosition","displayedImage","nativeElement","querySelector","offsetWidth","offsetHeight","aspectRatio","cropperHeight","cropperWidth","startMove","moveType","assign","getClientX","getClientY","moveImg","stopPropagation","preventDefault","move","resize","detectChanges","el","marginLeft","bypassSecurityTrustStyle","maintainSize","moveStop","diffX","diffY","Math","min","max","maintainAspectRatio","checkAspectRatio","overflowX","overflowY","autoCrop","crop","ratio","left","round","top_1","resizeRatio","getResizeRatio","resizedWidth","floor","resizedHeight","cropCanvas","cropToOutputType","output","cropperPosition","outputType","cropToFile","then","imageCropped","base64","cropToBase64","format","getQuality","imageCroppedBase64","getCanvasBlob","imageCroppedFile","Promise","resolve","toBlob","run","imageQuality","resizeToWidth","onlyScaleDown","touches","Component","args","selector","template","changeDetection","ChangeDetectionStrategy","OnPush","ElementRef","DomSanitizer","ChangeDetectorRef","NgZone","Input","Output","HostListener","ImageCropperModule","NgModule","imports","CommonModule","declarations","exports"],"mappings":"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","sourcesContent":["export class ImageUtils {\n    static getOrientation(imageBase64: string): number {\n        const view = new DataView(this.base64ToArrayBuffer(imageBase64));\n        if (view.getUint16(0, false) != 0xFFD8) {\n            return -2;\n        }\n        const length = view.byteLength;\n        let offset = 2;\n        while (offset < length) {\n            if (view.getUint16(offset + 2, false) <= 8) return -1;\n            const marker = view.getUint16(offset, false);\n            offset += 2;\n            if (marker == 0xFFE1) {\n                if (view.getUint32(offset += 2, false) != 0x45786966) {\n                    return -1;\n                }\n\n                const little = view.getUint16(offset += 6, false) == 0x4949;\n                offset += view.getUint32(offset + 4, little);\n                const tags = view.getUint16(offset, little);\n                offset += 2;\n                for (let i = 0; i < tags; i++) {\n                    if (view.getUint16(offset + (i * 12), little) == 0x0112) {\n                        return view.getUint16(offset + (i * 12) + 8, little);\n                    }\n                }\n            }\n            else if ((marker & 0xFF00) != 0xFF00) {\n                break;\n            }\n            else {\n                offset += view.getUint16(offset, false);\n            }\n        }\n        return -1;\n    }\n\n    private static base64ToArrayBuffer(imageBase64: string) {\n        imageBase64 = imageBase64.replace(/^data\\:([^\\;]+)\\;base64,/gmi, '');\n        const binaryString = atob(imageBase64);\n        const len = binaryString.length;\n        const bytes = new Uint8Array(len);\n        for (let i = 0; i < len; i++) {\n            bytes[i] = binaryString.charCodeAt(i);\n        }\n        return bytes.buffer;\n    }\n\n    static resetOrientation(srcBase64: string, srcOrientation: number, callback: Function) {\n        const img = new Image();\n        img.onload = function () {\n            const width = img.width;\n            const height = img.height;\n            const canvas = document.createElement('canvas');\n            const ctx = canvas.getContext('2d');\n\n            if (ctx) {\n                if (4 < srcOrientation && srcOrientation < 9) {\n                    canvas.width = height;\n                    canvas.height = width;\n                } else {\n                    canvas.width = width;\n                    canvas.height = height;\n                }\n                ImageUtils.transformCanvas(ctx, srcOrientation, width, height);\n                ctx.drawImage(img, 0, 0);\n                callback(canvas.toDataURL());\n            } else {\n                callback(srcBase64);\n            }\n        };\n        img.src = srcBase64;\n    }\n\n    private static transformCanvas(ctx: any, orientation: number, width: number, height: number) {\n        switch (orientation) {\n            case 2:\n                ctx.transform(-1, 0, 0, 1, width, 0);\n                break;\n            case 3:\n                ctx.transform(-1, 0, 0, -1, width, height);\n                break;\n            case 4:\n                ctx.transform(1, 0, 0, -1, 0, height);\n                break;\n            case 5:\n                ctx.transform(0, 1, 1, 0, 0, 0);\n                break;\n            case 6:\n                ctx.transform(0, 1, -1, 0, height, 0);\n                break;\n            case 7:\n                ctx.transform(0, -1, -1, 0, height, width);\n                break;\n            case 8:\n                ctx.transform(0, -1, 1, 0, 0, width);\n                break;\n            default:\n                break;\n        }\n    }\n}\n","import {\n    Component, ElementRef, EventEmitter, HostListener, Input, OnChanges, Output, SimpleChanges,\n    ChangeDetectorRef, ChangeDetectionStrategy, NgZone\n} from '@angular/core';\nimport { DomSanitizer, SafeUrl, SafeStyle } from '@angular/platform-browser';\nimport { ImageUtils } from './image.utils';\n\ninterface MoveStart {\n    active: boolean;\n    type: string | null;\n    position: string | null;\n    x1: number;\n    y1: number;\n    x2: number;\n    y2: number;\n    clientX: number;\n    clientY: number;\n}\n\ninterface Dimensions {\n    width: number;\n    height: number;\n}\n\nexport interface CropperPosition {\n    x1: number;\n    y1: number;\n    x2: number;\n    y2: number;\n}\n\nexport interface ImageCroppedEvent {\n    base64?: string | null;\n    file?: Blob | null;\n    width: number;\n    height: number;\n    cropperPosition: CropperPosition;\n}\n\n@Component({\n    selector: 'image-cropper',\n    templateUrl: './image-cropper.component.html',\n    styleUrls: ['./image-cropper.component.scss'],\n    changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ImageCropperComponent implements OnChanges {\n    private originalImage: any;\n    private moveStart: MoveStart;\n    private maxSize: Dimensions;\n    private originalSize: Dimensions;\n\n    safeImgDataUrl: SafeUrl | string;\n    marginLeft: SafeStyle | string = '0px';\n    imageVisible = false;\n\n    @Input()\n    set imageFileChanged(file: File) {\n        this.initCropper();\n        if (file) {\n            this.loadImageFile(file);\n        }\n    }\n\n    @Input()\n    set imageChangedEvent(event: any) {\n        this.initCropper();\n        if (event && event.target && event.target.files && event.target.files.length > 0) {\n            this.loadImageFile(event.target.files[0]);\n        }\n    }\n\n    @Input()\n    set imageBase64(imageBase64: string) {\n        this.initCropper();\n        this.loadBase64Image(imageBase64);\n    }\n\n    @Input() format: 'png' | 'jpeg' | 'bmp' | 'webp' | 'ico' = 'png';\n    @Input() outputType: 'base64' | 'file' | 'both' = 'both';\n    @Input() maintainAspectRatio = true;\n    @Input() aspectRatio = 1;\n    @Input() resizeToWidth = 0;\n    @Input() roundCropper = false;\n    @Input() onlyScaleDown = false;\n    @Input() imageQuality = 92;\n    @Input() autoCrop = true;\n    @Input() cropper: CropperPosition = {\n        x1: -100,\n        y1: -100,\n        x2: 10000,\n        y2: 10000\n    };\n\n    @Output() imageCropped = new EventEmitter<ImageCroppedEvent>();\n    @Output() imageCroppedBase64 = new EventEmitter<string>();\n    @Output() imageCroppedFile = new EventEmitter<Blob>();\n    @Output() imageLoaded = new EventEmitter<void>();\n    @Output() loadImageFailed = new EventEmitter<void>();\n\n    constructor(private elementRef: ElementRef,\n                private sanitizer: DomSanitizer,\n                private cd: ChangeDetectorRef,\n                private zone: NgZone) {\n        this.initCropper();\n    }\n\n    ngOnChanges(changes: SimpleChanges): void {\n        if (changes['cropper']) {\n            setTimeout(() => {\n                this.setMaxSize();\n                this.checkCropperPosition(false);\n                this.doAutoCrop();\n                this.cd.markForCheck();\n            });\n        }\n        if (changes['aspectRatio']) {\n            this.resetCropperPosition();\n        }\n    }\n\n    private initCropper() {\n        this.imageVisible = false;\n        this.originalImage = null;\n        this.safeImgDataUrl = 'data:image/png;base64,iVBORw0KGg'\n            + 'oAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAU'\n            + 'AAarVyFEAAAAASUVORK5CYII=';\n        this.moveStart = {\n            active: false,\n            type: null,\n            position: null,\n            x1: 0,\n            y1: 0,\n            x2: 0,\n            y2: 0,\n            clientX: 0,\n            clientY: 0\n        };\n        this.maxSize = {\n            width: 0,\n            height: 0\n        };\n        this.originalSize = {\n            width: 0,\n            height: 0\n        };\n        this.cropper.x1 = -100;\n        this.cropper.y1 = -100;\n        this.cropper.x2 = 10000;\n        this.cropper.y2 = 10000;\n    }\n\n    private loadImageFile(file: File) {\n        const fileReader = new FileReader();\n        fileReader.onload = (event: any) => {\n            const imageType = file.type;\n            if (this.isValidImageType(imageType)) {\n                try {\n                    this.checkExifRotationAndLoadImage(event.target.result);\n                } catch (e) {\n                    this.loadImageFailed.emit();\n                }\n            } else {\n                this.loadImageFailed.emit();\n            }\n        };\n        fileReader.readAsDataURL(file);\n    }\n\n    private isValidImageType(type: string) {\n        return type === 'image/jpeg'\n            || type === 'image/jpg'\n            || type === 'image/png'\n            || type === 'image/gif'\n            || type === 'image/tiff';\n    }\n\n    private checkExifRotationAndLoadImage(imageBase64: string) {\n        const exifRotation = ImageUtils.getOrientation(imageBase64);\n        if (exifRotation > 1) {\n            ImageUtils.resetOrientation(\n                imageBase64,\n                exifRotation,\n                (rotatedBase64: string) => this.loadBase64Image(rotatedBase64)\n            );\n        } else {\n            this.loadBase64Image(imageBase64);\n        }\n    }\n\n    private loadBase64Image(imageBase64: string) {\n        this.safeImgDataUrl = this.sanitizer.bypassSecurityTrustResourceUrl(imageBase64);\n        this.originalImage = new Image();\n        this.originalImage.onload = () => {\n            this.originalSize.width = this.originalImage.width;\n            this.originalSize.height = this.originalImage.height;\n            this.cd.markForCheck();\n        };\n        this.originalImage.src = imageBase64;\n    }\n\n    imageLoadedInView(): void {\n        if (this.originalImage != null) {\n            this.imageLoaded.emit();\n            setTimeout(() => {\n                this.setMaxSize();\n                this.resetCropperPosition();\n                this.cd.markForCheck();\n            });\n        }\n    }\n\n    @HostListener('window:resize', ['$event'])\n    onResize(event: Event) {\n        this.resizeCropperPosition();\n        this.setMaxSize();\n    }\n\n    private resizeCropperPosition() {\n        const displayedImage = this.elementRef.nativeElement.querySelector('.source-image');\n        if (this.maxSize.width !== displayedImage.offsetWidth || this.maxSize.height !== displayedImage.offsetHeight) {\n            this.cropper.x1 = this.cropper.x1 * displayedImage.offsetWidth / this.maxSize.width;\n            this.cropper.x2 = this.cropper.x2 * displayedImage.offsetWidth / this.maxSize.width;\n            this.cropper.y1 = this.cropper.y1 * displayedImage.offsetHeight / this.maxSize.height;\n            this.cropper.y2 = this.cropper.y2 * displayedImage.offsetHeight / this.maxSize.height;\n        }\n    }\n\n    private resetCropperPosition() {\n        const displayedImage = this.elementRef.nativeElement.querySelector('.source-image');\n        if (displayedImage.offsetWidth / this.aspectRatio < displayedImage.offsetHeight) {\n            this.cropper.x1 = 0;\n            this.cropper.x2 = displayedImage.offsetWidth;\n            const cropperHeight = displayedImage.offsetWidth / this.aspectRatio;\n            this.cropper.y1 = (displayedImage.offsetHeight - cropperHeight) / 2;\n            this.cropper.y2 = this.cropper.y1 + cropperHeight;\n        } else {\n            this.cropper.y1 = 0;\n            this.cropper.y2 = displayedImage.offsetHeight;\n            const cropperWidth = displayedImage.offsetHeight * this.aspectRatio;\n            this.cropper.x1 = (displayedImage.offsetWidth - cropperWidth) / 2;\n            this.cropper.x2 = this.cropper.x1 + cropperWidth;\n        }\n        this.doAutoCrop();\n        this.imageVisible = true;\n    }\n\n    startMove(event: any, moveType: string, position: string | null = null) {\n        this.moveStart = Object.assign({\n            active: true,\n            type: moveType,\n            position: position,\n            clientX: this.getClientX(event),\n            clientY: this.getClientY(event)\n        }, this.cropper);\n    }\n\n    @HostListener('document:mousemove', ['$event'])\n    @HostListener('document:touchmove', ['$event'])\n    moveImg(event: any) {\n        if (this.moveStart.active) {\n            event.stopPropagation();\n            event.preventDefault();\n            this.setMaxSize();\n            if (this.moveStart.type === 'move') {\n                this.move(event);\n                this.checkCropperPosition(true);\n            } else if (this.moveStart.type === 'resize') {\n                this.resize(event);\n                this.checkCropperPosition(false);\n            }\n            this.cd.detectChanges();\n        }\n    }\n\n    private setMaxSize() {\n        const el = this.elementRef.nativeElement.querySelector('.source-image');\n        this.maxSize.width = el.offsetWidth;\n        this.maxSize.height = el.offsetHeight;\n        this.marginLeft = this.sanitizer.bypassSecurityTrustStyle('calc(50% - ' + this.maxSize.width / 2 + 'px)');\n    }\n\n    private checkCropperPosition(maintainSize = false) {\n        if (this.cropper.x1 < 0) {\n            this.cropper.x2 -= maintainSize ? this.cropper.x1 : 0;\n            this.cropper.x1 = 0;\n        }\n        if (this.cropper.y1 < 0) {\n            this.cropper.y2 -= maintainSize ? this.cropper.y1 : 0;\n            this.cropper.y1 = 0;\n        }\n        if (this.cropper.x2 > this.maxSize.width) {\n            this.cropper.x1 -= maintainSize ? (this.cropper.x2 - this.maxSize.width) : 0;\n            this.cropper.x2 = this.maxSize.width;\n        }\n        if (this.cropper.y2 > this.maxSize.height) {\n            this.cropper.y1 -= maintainSize ? (this.cropper.y2 - this.maxSize.height) : 0;\n            this.cropper.y2 = this.maxSize.height;\n        }\n    }\n\n    @HostListener('document:mouseup', ['$event'])\n    @HostListener('document:touchend', ['$event'])\n    moveStop(event: any) {\n        if (this.moveStart.active) {\n            this.moveStart.active = false;\n            this.doAutoCrop();\n        }\n    }\n\n    private move(event: any) {\n        const diffX = this.getClientX(event) - this.moveStart.clientX;\n        const diffY = this.getClientY(event) - this.moveStart.clientY;\n\n        this.cropper.x1 = this.moveStart.x1 + diffX;\n        this.cropper.y1 = this.moveStart.y1 + diffY;\n        this.cropper.x2 = this.moveStart.x2 + diffX;\n        this.cropper.y2 = this.moveStart.y2 + diffY;\n    }\n\n    private resize(event: any) {\n        const diffX = this.getClientX(event) - this.moveStart.clientX;\n        const diffY = this.getClientY(event) - this.moveStart.clientY;\n        switch (this.moveStart.position) {\n            case 'left':\n                this.cropper.x1 = Math.min(this.moveStart.x1 + diffX, this.cropper.x2 - 20);\n                break;\n            case 'topleft':\n                this.cropper.x1 = Math.min(this.moveStart.x1 + diffX, this.cropper.x2 - 20);\n                this.cropper.y1 = Math.min(this.moveStart.y1 + diffY, this.cropper.y2 - 20);\n                break;\n            case 'top':\n                this.cropper.y1 = Math.min(this.moveStart.y1 + diffY, this.cropper.y2 - 20);\n                break;\n            case 'topright':\n                this.cropper.x2 = Math.max(this.moveStart.x2 + diffX, this.cropper.x1 + 20);\n                this.cropper.y1 = Math.min(this.moveStart.y1 + diffY, this.cropper.y2 - 20);\n                break;\n            case 'right':\n                this.cropper.x2 = Math.max(this.moveStart.x2 + diffX, this.cropper.x1 + 20);\n                break;\n            case 'bottomright':\n                this.cropper.x2 = Math.max(this.moveStart.x2 + diffX, this.cropper.x1 + 20);\n                this.cropper.y2 = Math.max(this.moveStart.y2 + diffY, this.cropper.y1 + 20);\n                break;\n            case 'bottom':\n                this.cropper.y2 = Math.max(this.moveStart.y2 + diffY, this.cropper.y1 + 20);\n                break;\n            case 'bottomleft':\n                this.cropper.x1 = Math.min(this.moveStart.x1 + diffX, this.cropper.x2 - 20);\n                this.cropper.y2 = Math.max(this.moveStart.y2 + diffY, this.cropper.y1 + 20);\n                break;\n        }\n\n        if (this.maintainAspectRatio) {\n            this.checkAspectRatio();\n        }\n    }\n\n    private checkAspectRatio() {\n        let overflowX = 0;\n        let overflowY = 0;\n\n        switch (this.moveStart.position) {\n            case 'top':\n                this.cropper.x2 = this.cropper.x1 + (this.cropper.y2 - this.cropper.y1) * this.aspectRatio;\n                overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n                overflowY = Math.max(0 - this.cropper.y1, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x2 -= (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y1 += (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n            case 'bottom':\n                this.cropper.x2 = this.cropper.x1 + (this.cropper.y2 - this.cropper.y1) * this.aspectRatio;\n                overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n                overflowY = Math.max(this.cropper.y2 - this.maxSize.height, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x2 -= (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y2 -= (overflowY * this.aspectRatio) > overflowX ? overflowY : (overflowX / this.aspectRatio);\n                }\n                break;\n            case 'topleft':\n                this.cropper.y1 = this.cropper.y2 - (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n                overflowX = Math.max(0 - this.cropper.x1, 0);\n                overflowY = Math.max(0 - this.cropper.y1, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x1 += (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y1 += (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n            case 'topright':\n                this.cropper.y1 = this.cropper.y2 - (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n                overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n                overflowY = Math.max(0 - this.cropper.y1, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x2 -= (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y1 += (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n            case 'right':\n            case 'bottomright':\n                this.cropper.y2 = this.cropper.y1 + (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n                overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n                overflowY = Math.max(this.cropper.y2 - this.maxSize.height, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x2 -= (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y2 -= (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n            case 'left':\n            case 'bottomleft':\n                this.cropper.y2 = this.cropper.y1 + (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n                overflowX = Math.max(0 - this.cropper.x1, 0);\n                overflowY = Math.max(this.cropper.y2 - this.maxSize.height, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x1 += (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y2 -= (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n        }\n    }\n\n    private doAutoCrop() {\n        if (this.autoCrop) {\n            this.crop();\n        }\n    }\n\n    crop() {\n        const displayedImage = this.elementRef.nativeElement.querySelector('.source-image');\n        if (displayedImage && this.originalImage != null) {\n            const ratio = this.originalSize.width / displayedImage.offsetWidth;\n            const left = Math.round(this.cropper.x1 * ratio);\n            const top = Math.round(this.cropper.y1 * ratio);\n            const width = Math.min(Math.round((this.cropper.x2 - this.cropper.x1) * ratio), this.originalSize.width - left);\n            const height = Math.min(Math.round((this.cropper.y2 - this.cropper.y1) * ratio), this.originalSize.height - top);\n            const resizeRatio = this.getResizeRatio(width);\n            const resizedWidth = Math.floor(width * resizeRatio);\n            const resizedHeight = Math.floor(height * resizeRatio);\n\n            const cropCanvas = document.createElement('canvas') as HTMLCanvasElement;\n            cropCanvas.width = resizedWidth;\n            cropCanvas.height = resizedHeight;\n\n            const ctx = cropCanvas.getContext('2d');\n            if (ctx) {\n                ctx.drawImage(this.originalImage, left, top, width, height, 0, 0, resizedWidth, resizedHeight);\n                this.cropToOutputType(cropCanvas, resizedWidth, resizedHeight);\n            }\n        }\n    }\n\n    private cropToOutputType(cropCanvas: HTMLCanvasElement, resizedWidth: number, resizedHeight: number): ImageCroppedEvent | Promise<ImageCroppedEvent> {\n        const output: ImageCroppedEvent = {\n            width: resizedWidth,\n            height: resizedHeight,\n            cropperPosition: Object.assign({}, this.cropper)\n        };\n        switch (this.outputType) {\n            case 'file':\n                return this.cropToFile(cropCanvas)\n                    .then((result: Blob | null) => {\n                        output.file = result;\n                        this.imageCropped.emit(output);\n                        return output;\n                    });\n            case 'both':\n                output.base64 = this.cropToBase64(cropCanvas);\n                return this.cropToFile(cropCanvas)\n                    .then((result: Blob | null) => {\n                        output.file = result;\n                        this.imageCropped.emit(output);\n                        return output;\n                    });\n            default:\n                output.base64 = this.cropToBase64(cropCanvas);\n                this.imageCropped.emit(output);\n                return output;\n        }\n    }\n\n    private cropToBase64(cropCanvas: HTMLCanvasElement): string {\n        const imageBase64 = cropCanvas.toDataURL('image/' + this.format, this.getQuality());\n        this.imageCroppedBase64.emit(imageBase64);\n        return imageBase64;\n    }\n\n    private cropToFile(cropCanvas: HTMLCanvasElement): Promise<Blob | null> {\n        return this.getCanvasBlob(cropCanvas)\n            .then((result: Blob | null) => {\n                if (result) {\n                    this.imageCroppedFile.emit(result);\n                }\n                return result;\n            });\n    }\n\n    private getCanvasBlob(cropCanvas: HTMLCanvasElement): Promise<Blob | null> {\n        return new Promise((resolve) => {\n            cropCanvas.toBlob(\n                (result: Blob | null) => this.zone.run(() => resolve(result)),\n                'image/' + this.format,\n                this.getQuality()\n            );\n        });\n    }\n\n    private getQuality(): number {\n        return Math.min(1, Math.max(0, this.imageQuality / 100));\n    }\n\n    private getResizeRatio(width: number): number {\n        return this.resizeToWidth > 0 && (!this.onlyScaleDown || width > this.resizeToWidth)\n            ? this.resizeToWidth / width\n            : 1;\n    }\n\n    private getClientX(event: any) {\n        return event.clientX != null ? event.clientX : event.touches[0].clientX;\n    }\n\n    private getClientY(event: any) {\n        return event.clientY != null ? event.clientY : event.touches[0].clientY;\n    }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ImageCropperComponent } from './image-cropper.component';\n\n@NgModule({\n    imports: [\n        CommonModule\n    ],\n    declarations: [\n        ImageCropperComponent\n    ],\n    exports: [\n        ImageCropperComponent\n    ]\n})\nexport class ImageCropperModule {}\n"]}